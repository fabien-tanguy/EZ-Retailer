<%= cloudinary_js_config %>
<%= form_tag(admin_photos_path,:method => :post, "data-ajax" => false) do  %>
        <li data-role="fieldcontain">
          <%= cl_image_upload_tag(:image, :html => {:class => "image_upload"}) %>
      </li>
	  <li data-role="fieldcontain">	
		  <%= submit_tag "Enregistrer dans l'album" %>
	  </li>	
<% end %>
<ul data-role="listview" data-theme="c" data-inset="true" >
	<li>
    	<span class="status">Chargement ...</span>
    	<span class="preview"></span>	  	
	</li>
</ul>	

<ul data-role="listview" data-theme="c" data-inset="true"  data-divider-theme ="b"  style="display:none;" id="delete-photo">
	<li><%= link_to "#{t('main.destroy')}".html_safe,  admin_destroy_photo_path(:image) , "data-ajax" => false, :id => "delete-photo" %></li>
</ul>

<!-- Progression -->
<script type="text/javascript">
$( document ).bind("pageinit", function( event, data ){

	$('.cloudinary-fileupload').bind('fileuploadprogress', function(e, data) { 
  		$(".status").text("Chargement... " + Math.round((data.loaded * 100.0) / data.total) + "%");
	});

	$('.cloudinary-fileupload').bind('cloudinarydone', function(e, data) {  
  		$('.status').hide();	
  		$('.preview').html($.cloudinary.image(data.result.public_id, { format: data.result.format, version: data.result.version,crop: 'fill', width: 80, height: 80 }));
	});
});	
</script>